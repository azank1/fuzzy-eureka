<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PoT Protocol MVP Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }
        
        .mvp-banner {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 25px;
            text-align: center;
            color: white;
        }
        
        .dashboard {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
        }
        
        .card h3 {
            margin-bottom: 15px;
            color: #444;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background-color: #4CAF50;
            animation: pulse 2s infinite;
        }
        
        .status-indicator.processing {
            background-color: #FF9800;
        }
        
        .status-indicator.error {
            background-color: #F44336;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .controls {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        button {
            background: linear-gradient(45deg, #FF6B6B, #4ECDC4);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            min-width: 140px;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        
        .rag-controls {
            margin-top: 15px;
        }
        
        .rag-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            margin-bottom: 10px;
            resize: vertical;
            min-height: 80px;
        }
        
        .rag-input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .logs {
            grid-column: 1 / -1;
            max-height: 300px;
            overflow-y: auto;
            background: #1a1a1a;
            color: #00ff00;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.4;
        }
        
        .log-entry {
            margin-bottom: 8px;
            padding: 4px 0;
            border-bottom: 1px solid rgba(0,255,0,0.1);
        }
        
        .timestamp {
            color: #888;
            font-size: 12px;
        }
        
        .registry-list {
            list-style: none;
        }
        
        .registry-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            margin-bottom: 8px;
            background: rgba(0,0,0,0.05);
            border-radius: 6px;
            border-left: 4px solid #4CAF50;
        }
        
        .adapter-name {
            font-weight: 600;
            color: #333;
        }
        
        .adapter-status {
            background: #4CAF50;
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .results-section {
            grid-column: 1 / -1;
            margin-top: 20px;
        }
        
        .results-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 15px;
        }
        
        .result-card {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 8px;
            padding: 20px;
            border-left: 4px solid #667eea;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .connection-status {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 10px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .connected {
            background: rgba(76, 175, 80, 0.9);
        }
        
        .disconnected {
            background: rgba(244, 67, 54, 0.9);
        }
        
        .system-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }
        
        .stat-item {
            text-align: center;
            padding: 10px;
            background: rgba(0,0,0,0.05);
            border-radius: 8px;
        }
        
        .stat-number {
            font-size: 24px;
            font-weight: bold;
            color: #667eea;
        }
        
        .stat-label {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="connection-status" id="connectionStatus">Connecting...</div>
    
    <div class="container">
        <div class="header">
            <h1>ü§ñ PoT Protocol MVP Dashboard</h1>
            <p>Multi-Agent Orchestration with RAG-Powered Task Execution</p>
        </div>
        
        <div class="mvp-banner">
            <h3>üéÜ MVP Features Showcase</h3>
            <p>Real orchestration engine ‚Ä¢ RAG-powered LLM agent ‚Ä¢ Live workspace analysis ‚Ä¢ Actual task execution</p>
        </div>
        
        <div class="dashboard">
            <div class="card">
                <h3>
                    <span class="status-indicator" id="systemStatusIndicator"></span>
                    System Status
                </h3>
                <div id="systemStatus">
                    <p>Initializing...</p>
                </div>
                
                <div class="system-stats" id="systemStats">
                    <div class="stat-item">
                        <div class="stat-number" id="taskCount">0</div>
                        <div class="stat-label">Tasks</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="clientCount">0</div>
                        <div class="stat-label">Clients</div>
                    </div>
                </div>
                
                <div class="controls">
                    <button onclick="runDemos()" id="runDemosBtn">üöÄ Run All Demos</button>
                    <button onclick="refreshStatus()">üîÑ Refresh</button>
                </div>
            </div>
            
            <div class="card">
                <h3>üìã Agent Registry</h3>
                <ul class="registry-list" id="agentRegistry">
                    <li>Loading adapters...</li>
                </ul>
            </div>
            
            <div class="card">
                <h3>ü§ñ RAG Task Execution</h3>
                <p style="font-size: 14px; color: #666; margin-bottom: 15px;">Enter natural language tasks for AI-powered execution:</p>
                
                <div class="rag-controls">
                    <textarea 
                        class="rag-input" 
                        id="ragTaskInput" 
                        placeholder="Example: 'List all TypeScript files in the orchestrator' or 'Analyze the project structure and create a summary'"
                    ></textarea>
                    <button onclick="executeRAGTask()" id="ragTaskBtn">üé® Execute Task</button>
                </div>
            </div>
        </div>
        
        <div class="card results-section" style="margin-bottom: 20px;">
            <h3>üß† MetaSuperAgent - Multi-Agent Orchestration</h3>
            <p style="font-size: 14px; color: #666; margin-bottom: 15px;">Submit complex tasks that require multiple specialized agents:</p>
            
            <div class="rag-controls">
                <textarea 
                    class="rag-input" 
                    id="megaTaskInput" 
                    placeholder="Example: 'Deploy the PoL smart contract and generate a zero-knowledge proof for verification' or 'Analyze all contracts, check ZK circuits, and create comprehensive documentation'"
                ></textarea>
                <button onclick="executeMegaTask()" id="megaTaskBtn" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">üöÄ Execute Mega Task</button>
                <button onclick="runMegaDemos()" id="megaDemosBtn" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">üéØ Run All Mega Demos</button>
            </div>
            
            <div class="mega-examples" style="margin-top: 15px; font-size: 13px; color: #777;">
                <strong>Example Mega Tasks:</strong>
                <ul style="margin-top: 8px; margin-left: 20px;">
                    <li>"Deploy smart contract and generate ZK proof"</li>
                    <li>"Analyze workspace and create documentation"</li>
                    <li>"Generate ZK proof, deploy contract, verify, and check API status"</li>
                    <li>"List all TypeScript files and summarize project structure"</li>
                </ul>
            </div>
        </div>
        
        <div class="card results-section">
            <h3>üìä Live Activity Logs</h3>
            <div class="logs" id="logs">
                <div class="log-entry">
                    <span class="timestamp">[System]</span> PoT Protocol MVP Dashboard initialized - Ready for orchestration and RAG tasks
                </div>
            </div>
        </div>
        
        <div class="card results-section" id="resultsSection" style="display: none;">
            <h3>üìà Task Results & Analysis</h3>
            <div class="results-grid">
                <div class="result-card">
                    <h4>RAG Analysis</h4>
                    <div id="ragAnalysis">No analysis yet</div>
                </div>
                <div class="result-card">
                    <h4>Execution Results</h4>
                    <div id="executionResults">No results yet</div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        let ws = null;
        let reconnectTimer = null;
        let systemState = { status: 'idle', completedTasks: 0 };
        
        function connectWebSocket() {
            const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsUrl = `${protocol}//${window.location.host}`;
            
            ws = new WebSocket(wsUrl);
            
            ws.onopen = function() {
                console.log('Connected to PoT Protocol Dashboard');
                updateConnectionStatus(true);
                if (reconnectTimer) {
                    clearInterval(reconnectTimer);
                    reconnectTimer = null;
                }
            };
            
            ws.onmessage = function(event) {
                const data = JSON.parse(event.data);
                handleWebSocketMessage(data);
            };
            
            ws.onclose = function() {
                console.log('Disconnected from dashboard');
                updateConnectionStatus(false);
                attemptReconnect();
            };
            
            ws.onerror = function(error) {
                console.error('WebSocket error:', error);
                updateConnectionStatus(false);
            };
        }
        
        function attemptReconnect() {
            if (!reconnectTimer) {
                reconnectTimer = setInterval(() => {
                    console.log('Attempting to reconnect...');
                    connectWebSocket();
                }, 3000);
            }
        }
        
        function updateConnectionStatus(connected) {
            const status = document.getElementById('connectionStatus');
            if (connected) {
                status.textContent = '‚úÖ Connected';
                status.className = 'connection-status connected';
            } else {
                status.textContent = '‚ùå Disconnected';
                status.className = 'connection-status disconnected';
            }
        }
        
        function handleWebSocketMessage(data) {
            if (data.systemState) {
                systemState = data.systemState;
                updateSystemStats();
                updateStatusIndicator(systemState.status);
            }
            
            addLog(data.type, data.message, data.timestamp);
            
            switch (data.type) {
                case 'status':
                    updateSystemStatus(data.message);
                    break;
                case 'demo_start':
                    document.getElementById('runDemosBtn').disabled = true;
                    document.getElementById('runDemosBtn').textContent = 'üîÑ Running...';
                    break;
                case 'demo_complete':
                    document.getElementById('runDemosBtn').disabled = false;
                    document.getElementById('runDemosBtn').textContent = 'üöÄ Run All Demos';
                    break;
                case 'mega_task_start':
                    document.getElementById('megaTaskBtn').disabled = true;
                    document.getElementById('megaTaskBtn').textContent = 'üîÑ Analyzing...';
                    updateSystemStatus('üß† MetaSuperAgent analyzing task...');
                    break;
                case 'mega_task_analysis':
                    updateSystemStatus('üîç Selecting specialized agents...');
                    break;
                case 'mega_task_complete':
                    document.getElementById('megaTaskBtn').disabled = false;
                    document.getElementById('megaTaskBtn').textContent = 'üöÄ Execute Mega Task';
                    updateSystemStatus('‚úÖ Mega task completed successfully');
                    if (data.result) {
                        showMegaTaskResults(data.result);
                    }
                    break;
                case 'mega_task_error':
                    document.getElementById('megaTaskBtn').disabled = false;
                    document.getElementById('megaTaskBtn').textContent = 'üöÄ Execute Mega Task';
                    updateSystemStatus('‚ùå Mega task failed');
                    break;
                case 'mega_demo_start':
                    document.getElementById('megaDemosBtn').disabled = true;
                    document.getElementById('megaDemosBtn').textContent = 'üîÑ Running...';
                    break;
                case 'mega_demo_complete':
                    document.getElementById('megaDemosBtn').disabled = false;
                    document.getElementById('megaDemosBtn').textContent = 'üéØ Run All Mega Demos';
                    break;
                case 'demo_error':
                    document.getElementById('runDemosBtn').disabled = false;
                    document.getElementById('runDemosBtn').textContent = 'üöÄ Run All Demos';
                    break;
                case 'rag_start':
                    document.getElementById('ragTaskBtn').disabled = true;
                    document.getElementById('ragTaskBtn').textContent = 'üîÑ Processing...';
                    break;
                case 'rag_complete':
                    document.getElementById('ragTaskBtn').disabled = false;
                    document.getElementById('ragTaskBtn').textContent = 'üé® Execute Task';
                    showRAGResults(data.result, data.logs);
                    break;
                case 'rag_error':
                    document.getElementById('ragTaskBtn').disabled = false;
                    document.getElementById('ragTaskBtn').textContent = 'üé® Execute Task';
                    break;
            }
        }
        
        function updateStatusIndicator(status) {
            const indicator = document.getElementById('systemStatusIndicator');
            indicator.className = 'status-indicator';
            
            switch (status) {
                case 'processing_rag':
                case 'running_demos':
                    indicator.classList.add('processing');
                    break;
                case 'error':
                    indicator.classList.add('error');
                    break;
                default:
                    // Keep default green
                    break;
            }
        }
        
        function updateSystemStats() {
            document.getElementById('taskCount').textContent = systemState.completedTasks || 0;
        }
        
        function showRAGResults(result, logs) {
            const resultsSection = document.getElementById('resultsSection');
            const ragAnalysis = document.getElementById('ragAnalysis');
            const executionResults = document.getElementById('executionResults');
            
            resultsSection.style.display = 'block';
            
            if (result && result.analysis) {
                ragAnalysis.innerHTML = `
                    <p><strong>Analysis:</strong> ${result.analysis}</p>
                    <p><strong>Expected:</strong> ${result.expected}</p>
                    <p><strong>Actions Performed:</strong> ${result.results?.length || 0}</p>
                `;
            }
            
            if (result && result.results) {
                const resultsHtml = result.results.map(r => `
                    <div style="margin-bottom: 10px; padding: 10px; background: rgba(0,0,0,0.05); border-radius: 4px;">
                        <strong>${r.action}</strong><br>
                        <span style="font-size: 12px; color: #666;">${r.result || r.error || 'Completed'}</span>
                    </div>
                `).join('');
                executionResults.innerHTML = resultsHtml;
            }
        }
        
        function showMegaTaskResults(result) {
            const resultsSection = document.getElementById('resultsSection');
            const ragAnalysis = document.getElementById('ragAnalysis');
            const executionResults = document.getElementById('executionResults');
            
            resultsSection.style.display = 'block';
            
            ragAnalysis.innerHTML = `
                <h4>üß† MetaSuperAgent Analysis</h4>
                <p><strong>Task:</strong> ${result.task}</p>
                <p><strong>Agents Used:</strong> ${result.agentsUsed.join(', ')}</p>
                <p><strong>Workflow Steps:</strong> ${result.workflow.steps.length}</p>
            `;
            
            const stepResults = result.workflow.steps.map((step, i) => {
                const stepResult = result.context[step.outputKey];
                return `
                    <div style="margin-bottom: 12px; padding: 12px; background: rgba(0,0,0,0.05); border-radius: 4px; border-left: 4px solid #667eea;">
                        <strong>Step ${i + 1}: ${step.agentId}</strong><br>
                        <span style="font-size: 12px; color: #666;">
                            Input: ${step.inputKey} ‚Üí Output: ${step.outputKey}<br>
                            ${stepResult ? `<pre style="margin-top: 5px; background: white; padding: 8px; border-radius: 4px; overflow-x: auto; font-size: 11px;">${JSON.stringify(stepResult, null, 2).substring(0, 300)}...</pre>` : ''}
                        </span>
                    </div>
                `;
            }).join('');
            
            executionResults.innerHTML = `
                <h4>üìä Execution Results</h4>
                ${stepResults}
                <div style="margin-top: 15px; padding: 12px; background: rgba(102, 126, 234, 0.1); border-radius: 4px;">
                    <strong>Summary:</strong><br>
                    <pre style="margin-top: 5px; background: white; padding: 10px; border-radius: 4px; overflow-x: auto; font-size: 12px; white-space: pre-wrap;">${result.summary}</pre>
                </div>
            `;
        }
        
        function addLog(type, message, timestamp) {
            const logs = document.getElementById('logs');
            const entry = document.createElement('div');
            entry.className = 'log-entry';
            
            const time = new Date(timestamp).toLocaleTimeString();
            entry.innerHTML = `<span class="timestamp">[${time}]</span> ${message}`;
            
            logs.appendChild(entry);
            logs.scrollTop = logs.scrollHeight;
            
            // Keep only last 50 entries
            while (logs.children.length > 50) {
                logs.removeChild(logs.firstChild);
            }
        }
        
        function updateSystemStatus(message) {
            document.getElementById('systemStatus').innerHTML = `<p>${message}</p>`;
        }
        
        async function runDemos() {
            try {
                const response = await fetch('/api/demo/run', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                
                const result = await response.json();
                console.log('Demos completed:', result);
            } catch (error) {
                console.error('Failed to run demos:', error);
                addLog('error', `Failed to run demos: ${error.message}`, new Date().toISOString());
            }
        }
        
        async function executeRAGTask() {
            const taskInput = document.getElementById('ragTaskInput');
            const task = taskInput.value.trim();
            
            if (!task) {
                alert('Please enter a task description');
                return;
            }
            
            try {
                const response = await fetch('/api/rag/task', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ task })
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                
                const result = await response.json();
                console.log('RAG task completed:', result);
                taskInput.value = ''; // Clear input
            } catch (error) {
                console.error('Failed to execute RAG task:', error);
                addLog('error', `Failed to execute RAG task: ${error.message}`, new Date().toISOString());
            }
        }
        
        async function executeMegaTask() {
            const taskInput = document.getElementById('megaTaskInput');
            const task = taskInput.value.trim();
            
            if (!task) {
                alert('Please enter a mega task description');
                return;
            }
            
            try {
                const response = await fetch('/api/mega-task', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        task,
                        description: 'User-submitted mega task from dashboard'
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                
                const result = await response.json();
                console.log('Mega task completed:', result);
                
                if (result.success) {
                    addLog('success', `‚úÖ Mega task completed using ${result.result.agentsUsed.length} agents`, new Date().toISOString());
                    
                    // Show detailed results
                    const resultsSection = document.getElementById('resultsSection');
                    const executionResults = document.getElementById('executionResults');
                    resultsSection.style.display = 'block';
                    
                    executionResults.innerHTML = `
                        <div style="margin-bottom: 15px;">
                            <strong>Agents Used:</strong> ${result.result.agentsUsed.join(', ')}
                        </div>
                        <div style="margin-bottom: 15px;">
                            <strong>Workflow Steps:</strong> ${result.result.workflow.steps.length}
                        </div>
                        <div>
                            <strong>Summary:</strong><br>
                            <pre style="background: rgba(0,0,0,0.05); padding: 10px; border-radius: 4px; overflow-x: auto; font-size: 12px;">${result.result.summary}</pre>
                        </div>
                    `;
                }
                
                taskInput.value = ''; // Clear input
            } catch (error) {
                console.error('Failed to execute mega task:', error);
                addLog('error', `Failed to execute mega task: ${error.message}`, new Date().toISOString());
            }
        }
        
        async function runMegaDemos() {
            try {
                const response = await fetch('/api/mega-demo/run', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                
                const result = await response.json();
                console.log('Mega demos completed:', result);
            } catch (error) {
                console.error('Failed to run mega demos:', error);
                addLog('error', `Failed to run mega demos: ${error.message}`, new Date().toISOString());
            }
        }
        
        async function refreshStatus() {
            try {
                const response = await fetch('/api/status');
                const status = await response.json();
                updateSystemStatus(`System ${status.status} - ${status.clients} clients connected`);
                document.getElementById('clientCount').textContent = status.clients;
                
                if (status.systemState) {
                    systemState = status.systemState;
                    updateSystemStats();
                }
                
                // Update registry
                const registryResponse = await fetch('/api/registry');
                const registry = await registryResponse.json();
                updateRegistry(registry.adapters);
            } catch (error) {
                console.error('Failed to refresh status:', error);
            }
        }
        
        function updateRegistry(adapters) {
            const registry = document.getElementById('agentRegistry');
            registry.innerHTML = '';
            
            adapters.forEach(adapter => {
                const item = document.createElement('li');
                item.className = 'registry-item';
                item.innerHTML = `
                    <div>
                        <div class="adapter-name">${adapter.name}</div>
                        <div style="font-size: 12px; color: #666;">${adapter.capabilities.join(', ')}</div>
                    </div>
                    <span class="adapter-status">${adapter.status}</span>
                `;
                registry.appendChild(item);
            });
        }
        
        // Add sample tasks
        const sampleTasks = [
            'List all TypeScript files in the orchestrator directory',
            'Analyze the project structure and create a summary',
            'Show me the main components of this workspace',
            'Create a file listing all the smart contracts',
            'Explain what the ZK circuit does'
        ];
        
        // Add sample task buttons
        function addSampleTasks() {
            const taskInput = document.getElementById('ragTaskInput');
            const ragControls = taskInput.parentElement;
            
            const samplesDiv = document.createElement('div');
            samplesDiv.innerHTML = '<p style="font-size: 12px; color: #666; margin: 10px 0 5px 0;">Quick samples:</p>';
            
            sampleTasks.forEach(task => {
                const btn = document.createElement('button');
                btn.textContent = task;
                btn.style.cssText = 'font-size: 11px; padding: 6px 12px; margin: 2px; background: #f0f0f0; color: #333; border: 1px solid #ddd;';
                btn.onclick = () => taskInput.value = task;
                samplesDiv.appendChild(btn);
            });
            
            ragControls.appendChild(samplesDiv);
        }
        
        // Initialize dashboard
        connectWebSocket();
        refreshStatus();
        addSampleTasks();
        
        // Auto-refresh every 30 seconds
        setInterval(refreshStatus, 30000);
        
        // Allow Enter key to submit RAG task
        document.getElementById('ragTaskInput').addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && e.ctrlKey) {
                executeRAGTask();
            }
        });
    </script>
</body>
</html>